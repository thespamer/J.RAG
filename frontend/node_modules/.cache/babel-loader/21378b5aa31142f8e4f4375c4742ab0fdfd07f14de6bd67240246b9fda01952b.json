{"ast":null,"code":"import React from'react';import{Box,Paper,Typography,Button,Grid,CircularProgress,Alert,FormControl,InputLabel,Select,MenuItem,IconButton,Tooltip,Slider,Dialog,DialogTitle,DialogContent,DialogActions,TextField,Switch,FormControlLabel,Card,CardContent,LinearProgress}from'@mui/material';import{Save as SaveIcon,ContentCopy as CopyIcon,Code as CodeIcon,Refresh as RefreshIcon,Settings as SettingsIcon,Memory as MemoryIcon,CheckCircle as CheckCircleIcon,Error as ErrorIcon}from'@mui/icons-material';import Editor from'@monaco-editor/react';import axios from'axios';import Prism from'prismjs';import'prismjs/themes/prism.css';import'prismjs/components/prism-python';import'prismjs/components/prism-javascript';import'prismjs/components/prism-java';import'prismjs/components/prism-csharp';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const models=[{id:'deepseek-7b',name:'DeepSeek LLM 7B',description:'Optimized for code and technical content'}];const templates=[{name:'RAG Template',content:'Given the context:\\n{context}\\n\\nAnswer the question: {question}'},{name:'Code Generation',content:'Write a function that:\\n\\nRequirements:\\n{requirements}\\n\\nUse {language} programming language.'},{name:'Technical Analysis',content:'Analyze the following code and explain:\\n\\n{code}\\n\\nFocus on:\\n1. Architecture\\n2. Best practices\\n3. Potential improvements'}];const defaultModelConfig={temperature:0.7,maxTokens:1024,topP:0.9,presencePenalty:0,frequencyPenalty:0,lowCpuMemUsage:true,useSafetensors:true,offloadEnabled:false};function PromptStudio(){const[selectedModel,setSelectedModel]=React.useState('deepseek-7b');const[prompt,setPrompt]=React.useState('');const[response,setResponse]=React.useState('');const[loading,setLoading]=React.useState(false);const[error,setError]=React.useState('');const[savedPrompts,setSavedPrompts]=React.useState([]);const[modelConfig,setModelConfig]=React.useState(defaultModelConfig);const[openConfigDialog,setOpenConfigDialog]=React.useState(false);const[saveDialogOpen,setSaveDialogOpen]=React.useState(false);const[promptName,setPromptName]=React.useState('');const[responseFormat,setResponseFormat]=React.useState('text');const[modelStatus,setModelStatus]=React.useState({status:'unknown',downloadProgress:0,loadProgress:0,error:null,integrityCheck:null});const[systemStatus,setSystemStatus]=React.useState({memory:{available:0,total:0}});React.useEffect(()=>{loadSavedPrompts();// Fetch model and system status periodically\nconst fetchStatus=async()=>{try{const[modelRes,systemRes]=await Promise.all([axios.get('/api/models/status'),axios.get('/api/system/status')]);setModelStatus(modelRes.data);setSystemStatus(systemRes.data);}catch(error){console.error('Error fetching status:',error);}};fetchStatus();const interval=setInterval(fetchStatus,5000);return()=>clearInterval(interval);},[]);const loadSavedPrompts=async()=>{try{const response=await axios.get('/api/prompts');setSavedPrompts(response.data);}catch(error){console.error('Error loading prompts:',error);}};const handleModelChange=event=>{setSelectedModel(event.target.value);};const handleTemplateSelect=template=>{setPrompt(template.content);};const handleConfigChange=field=>(event,value)=>{const newValue=value!==undefined?value:field==='lowCpuMemUsage'||field==='useSafetensors'||field==='offloadEnabled'?event.target.checked:event.target.value;setModelConfig({...modelConfig,[field]:newValue});// If this is a memory optimization setting, update it on the backend\nif(['lowCpuMemUsage','useSafetensors','offloadEnabled'].includes(field)){updateSystemConfig({[field]:newValue});}};const updateSystemConfig=async config=>{try{await axios.post('/api/system/config',config);}catch(error){setError('Error updating system configuration');console.error('Error updating config:',error);}};const handleSubmit=async()=>{if(modelStatus.status!=='ready'){setError('Model is not ready. Please wait for it to finish loading.');return;}setLoading(true);setError('');setResponse('');try{const response=await axios.post('/api/prompt/generate',{prompt,model:selectedModel,config:modelConfig});setResponse(response.data.response);}catch(error){var _error$response,_error$response$data;setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Error generating response');}finally{setLoading(false);}};const handleSavePrompt=async()=>{try{await axios.post('/api/prompts',{name:promptName,prompt,model:selectedModel,config:modelConfig});setSaveDialogOpen(false);setPromptName('');loadSavedPrompts();}catch(error){var _error$response2,_error$response2$data;setError(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Error saving prompt');}};const handleCopyResponse=()=>{navigator.clipboard.writeText(response);};const handleFormatCode=()=>{const codeBlockRegex=/```(\\w+)?\\n([\\s\\S]*?)\\n```/g;let formattedResponse=response;let match;while((match=codeBlockRegex.exec(response))!==null){const[fullMatch,lang,code]=match;const language=lang||'text';try{const highlighted=Prism.highlight(code,Prism.languages[language]||Prism.languages.text,language);formattedResponse=formattedResponse.replace(fullMatch,`<pre class=\"language-${language}\"><code>${highlighted}</code></pre>`);}catch(error){console.error('Error formatting code:',error);}}setResponse(formattedResponse);setResponseFormat('code');};const formatBytes=bytes=>{if(bytes===0)return'0 B';const k=1024;const sizes=['B','KB','MB','GB','TB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return`${parseFloat((bytes/Math.pow(k,i)).toFixed(2))} ${sizes[i]}`;};return/*#__PURE__*/_jsxs(Box,{sx:{maxWidth:1200,mx:'auto',mt:4},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:\"Prompt Studio\"}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(SettingsIcon,{}),onClick:()=>setOpenConfigDialog(true),sx:{mr:1},children:\"Model Settings\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(MemoryIcon,{}),onClick:()=>setOpenConfigDialog(true),children:\"Memory Settings\"})]})]}),/*#__PURE__*/_jsx(Card,{sx:{mb:3},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{flexGrow:1},children:\"DeepSeek LLM 7B Status\"}),modelStatus.status==='ready'&&/*#__PURE__*/_jsx(CheckCircleIcon,{color:\"success\"}),modelStatus.status==='error'&&/*#__PURE__*/_jsx(ErrorIcon,{color:\"error\"})]}),modelStatus.status==='downloading'&&/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:\"Downloading model files...\"}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:modelStatus.downloadProgress}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"textSecondary\",children:[modelStatus.downloadProgress.toFixed(1),\"%\"]})]}),modelStatus.status==='loading'&&/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:\"Loading model into memory...\"}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:modelStatus.loadProgress}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"textSecondary\",children:[modelStatus.loadProgress.toFixed(1),\"%\"]})]}),modelStatus.integrityCheck&&/*#__PURE__*/_jsx(Alert,{severity:modelStatus.integrityCheck.passed?\"success\":\"error\",sx:{mt:1},children:modelStatus.integrityCheck.message}),modelStatus.error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mt:1},children:modelStatus.error}),/*#__PURE__*/_jsx(Box,{sx:{mt:2},children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",children:[\"Available Memory: \",formatBytes(systemStatus.memory.available)]})})]})}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mb:2},children:error}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:8,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3},children:[/*#__PURE__*/_jsx(Box,{sx:{mb:3},children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Model\"}),/*#__PURE__*/_jsx(Select,{value:selectedModel,label:\"Model\",onChange:handleModelChange,children:models.map(model=>/*#__PURE__*/_jsx(MenuItem,{value:model.id,children:/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",children:model.name}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:model.description})]})},model.id))})]})}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Prompt\"}),/*#__PURE__*/_jsx(Box,{sx:{mb:2},children:/*#__PURE__*/_jsx(Editor,{height:\"300px\",language:\"markdown\",value:prompt,onChange:setPrompt,theme:\"vs-dark\",options:{minimap:{enabled:false},lineNumbers:'on',fontSize:14,wordWrap:'on'}})}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',gap:1},children:[/*#__PURE__*/_jsxs(Button,{variant:\"contained\",onClick:handleSubmit,disabled:!prompt||loading,children:[\"Generate\",loading&&/*#__PURE__*/_jsx(CircularProgress,{size:24,sx:{ml:1}})]}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(SaveIcon,{}),onClick:()=>setSaveDialogOpen(true),disabled:!prompt,children:\"Save Prompt\"})]}),response&&/*#__PURE__*/_jsxs(Paper,{sx:{p:2,mt:3},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',mb:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Response\"}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Tooltip,{title:\"Copy Response\",children:/*#__PURE__*/_jsx(IconButton,{onClick:handleCopyResponse,children:/*#__PURE__*/_jsx(CopyIcon,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Format as Code\",children:/*#__PURE__*/_jsx(IconButton,{onClick:handleFormatCode,children:/*#__PURE__*/_jsx(CodeIcon,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Regenerate\",children:/*#__PURE__*/_jsx(IconButton,{onClick:handleSubmit,disabled:loading,children:/*#__PURE__*/_jsx(RefreshIcon,{})})})]})]}),responseFormat==='code'?/*#__PURE__*/_jsx(\"div\",{dangerouslySetInnerHTML:{__html:response},style:{backgroundColor:'#2d2d2d',padding:'16px',borderRadius:'4px',overflowX:'auto'}}):/*#__PURE__*/_jsx(Editor,{height:\"300px\",language:\"markdown\",value:response,theme:\"vs-dark\",options:{readOnly:true,minimap:{enabled:false},lineNumbers:'on',fontSize:14,wordWrap:'on'}})]})]})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,md:4,children:[/*#__PURE__*/_jsxs(Paper,{sx:{p:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Templates\"}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:templates.map(template=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2,cursor:'pointer','&:hover':{bgcolor:'action.hover'}},onClick:()=>handleTemplateSelect(template),children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",children:template.name}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",sx:{whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'},children:template.content})]})},template.name))})]}),savedPrompts.length>0&&/*#__PURE__*/_jsxs(Paper,{sx:{p:3,mt:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Saved Prompts\"}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:savedPrompts.map((saved,index)=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2,cursor:'pointer','&:hover':{bgcolor:'action.hover'}},onClick:()=>{setPrompt(saved.prompt);setSelectedModel(saved.model);setModelConfig(saved.config||defaultModelConfig);},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",children:saved.name}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",sx:{whiteSpace:'nowrap',overflow:'hidden',textOverflow:'ellipsis'},children:saved.prompt}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"textSecondary\",children:[\"Model: \",saved.model]})]})},index))})]})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:openConfigDialog,onClose:()=>setOpenConfigDialog(false),maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Model Configuration\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{mt:2,mb:1},children:\"Generation Settings\"}),/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsxs(Typography,{gutterBottom:true,children:[\"Temperature: \",modelConfig.temperature]}),/*#__PURE__*/_jsx(Slider,{value:modelConfig.temperature,onChange:handleConfigChange('temperature'),min:0,max:1,step:0.1,marks:true,valueLabelDisplay:\"auto\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsxs(Typography,{gutterBottom:true,children:[\"Max Tokens: \",modelConfig.maxTokens]}),/*#__PURE__*/_jsx(Slider,{value:modelConfig.maxTokens,onChange:handleConfigChange('maxTokens'),min:256,max:2048,step:256,marks:true,valueLabelDisplay:\"auto\"})]}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{mt:3,mb:1},children:\"Memory Optimization\"}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:modelConfig.lowCpuMemUsage,onChange:handleConfigChange('lowCpuMemUsage')}),label:\"Low CPU Memory Usage\"}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",display:\"block\",children:\"Optimize memory usage during model loading\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:modelConfig.useSafetensors,onChange:handleConfigChange('useSafetensors')}),label:\"Use Safetensors\"}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",display:\"block\",children:\"Use optimized tensor storage format\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:modelConfig.offloadEnabled,onChange:handleConfigChange('offloadEnabled')}),label:\"Enable Weight Offloading\"}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",display:\"block\",children:\"Offload model weights to disk when memory is constrained\"})]})]}),/*#__PURE__*/_jsx(DialogActions,{children:/*#__PURE__*/_jsx(Button,{onClick:()=>setOpenConfigDialog(false),children:\"Close\"})})]}),/*#__PURE__*/_jsxs(Dialog,{open:saveDialogOpen,onClose:()=>setSaveDialogOpen(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Save Prompt\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(TextField,{autoFocus:true,margin:\"dense\",label:\"Prompt Name\",fullWidth:true,value:promptName,onChange:e=>setPromptName(e.target.value)})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setSaveDialogOpen(false),children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleSavePrompt,variant:\"contained\",children:\"Save\"})]})]})]});}export default PromptStudio;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}