{"ast":null,"code":"import React from'react';import{Box,Paper,Typography,CircularProgress,LinearProgress,Alert,Button,Grid,Card,CardContent,IconButton,Tooltip,Switch,FormControlLabel,Dialog,DialogTitle,DialogContent,DialogActions,TextField}from'@mui/material';import{Storage as StorageIcon,Memory as MemoryIcon,Delete as DeleteIcon,Refresh as RefreshIcon,Settings as SettingsIcon,Warning as WarningIcon,CheckCircle as CheckCircleIcon,Error as ErrorIcon}from'@mui/icons-material';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function SystemStatus(){const[systemStatus,setSystemStatus]=React.useState({diskSpace:{total:0,used:0,available:0},memory:{total:0,used:0,available:0},model:{status:'unknown',// unknown, downloading, loading, ready, error\ndownloadProgress:0,loadProgress:0,error:null,integrityCheck:null},cache:{size:0,files:0,lastCleanup:null}});const[modelConfig,setModelConfig]=React.useState({lowCpuMemUsage:true,useSafetensors:true,offloadEnabled:false,offloadFolder:'/app/models_cache/offload'});const[configDialogOpen,setConfigDialogOpen]=React.useState(false);const[loading,setLoading]=React.useState(false);const[error,setError]=React.useState(null);const fetchSystemStatus=async()=>{try{const response=await axios.get('/api/system/status');setSystemStatus(response.data);}catch(error){var _error$response,_error$response$data;setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Error fetching system status');}};const handleConfigChange=async field=>{try{setLoading(true);const newConfig={...modelConfig,[field]:!modelConfig[field]};await axios.post('/api/system/config',newConfig);setModelConfig(newConfig);}catch(error){var _error$response2,_error$response2$data;setError(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Error updating configuration');}finally{setLoading(false);}};const handleCacheCleanup=async()=>{try{setLoading(true);await axios.post('/api/system/cache/cleanup');await fetchSystemStatus();}catch(error){var _error$response3,_error$response3$data;setError(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.error)||'Error cleaning cache');}finally{setLoading(false);}};const handleOffloadFolderChange=async folder=>{try{setLoading(true);await axios.post('/api/system/config',{...modelConfig,offloadFolder:folder});setModelConfig(prev=>({...prev,offloadFolder:folder}));}catch(error){var _error$response4,_error$response4$data;setError(((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.error)||'Error updating offload folder');}finally{setLoading(false);}};React.useEffect(()=>{fetchSystemStatus();const interval=setInterval(fetchSystemStatus,5000);return()=>clearInterval(interval);},[]);const formatBytes=bytes=>{if(bytes===0)return'0 B';const k=1024;const sizes=['B','KB','MB','GB','TB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return`${parseFloat((bytes/Math.pow(k,i)).toFixed(2))} ${sizes[i]}`;};const getStatusColor=(value,threshold)=>{if(value>=threshold.high)return'error';if(value>=threshold.medium)return'warning';return'success';};return/*#__PURE__*/_jsxs(Box,{sx:{maxWidth:1200,mx:'auto',mt:4},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:\"System Status\"}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(IconButton,{onClick:fetchSystemStatus,disabled:loading,children:/*#__PURE__*/_jsx(RefreshIcon,{})}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>setConfigDialogOpen(true),disabled:loading,children:/*#__PURE__*/_jsx(SettingsIcon,{})})]})]}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mb:2},onClose:()=>setError(null),children:error}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(StorageIcon,{sx:{mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Disk Space\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:[\"Available: \",formatBytes(systemStatus.diskSpace.available)]}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:systemStatus.diskSpace.used/systemStatus.diskSpace.total*100,color:getStatusColor(systemStatus.diskSpace.used/systemStatus.diskSpace.total*100,{medium:70,high:90})}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"textSecondary\",children:[formatBytes(systemStatus.diskSpace.used),\" of \",formatBytes(systemStatus.diskSpace.total),\" used\"]})]}),systemStatus.diskSpace.available<10*1024*1024*1024&&/*#__PURE__*/_jsx(Alert,{severity:\"warning\",sx:{mt:1},children:\"Less than 10GB available disk space. Model download and processing may be affected.\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(MemoryIcon,{sx:{mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Memory Usage\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:[\"Available: \",formatBytes(systemStatus.memory.available)]}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:systemStatus.memory.used/systemStatus.memory.total*100,color:getStatusColor(systemStatus.memory.used/systemStatus.memory.total*100,{medium:80,high:90})}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"textSecondary\",children:[formatBytes(systemStatus.memory.used),\" of \",formatBytes(systemStatus.memory.total),\" used\"]})]}),systemStatus.memory.available<2*1024*1024*1024&&/*#__PURE__*/_jsx(Alert,{severity:\"warning\",sx:{mt:1},children:\"Less than 2GB available memory. Model performance may be affected.\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"DeepSeek LLM 7B Status\"}),systemStatus.model.status==='ready'&&/*#__PURE__*/_jsx(CheckCircleIcon,{color:\"success\",sx:{ml:1}}),systemStatus.model.status==='error'&&/*#__PURE__*/_jsx(ErrorIcon,{color:\"error\",sx:{ml:1}})]}),systemStatus.model.status==='downloading'&&/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:\"Downloading model files...\"}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:systemStatus.model.downloadProgress}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"textSecondary\",children:[systemStatus.model.downloadProgress.toFixed(1),\"%\"]})]}),systemStatus.model.status==='loading'&&/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:\"Loading model into memory...\"}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:systemStatus.model.loadProgress}),/*#__PURE__*/_jsxs(Typography,{variant:\"caption\",color:\"textSecondary\",children:[systemStatus.model.loadProgress.toFixed(1),\"%\"]})]}),systemStatus.model.integrityCheck&&/*#__PURE__*/_jsx(Alert,{severity:systemStatus.model.integrityCheck.passed?\"success\":\"error\",sx:{mt:1},children:systemStatus.model.integrityCheck.message}),systemStatus.model.error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mt:1},children:systemStatus.model.error})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Cache Status\"}),/*#__PURE__*/_jsx(Button,{startIcon:/*#__PURE__*/_jsx(DeleteIcon,{}),onClick:handleCacheCleanup,disabled:loading,children:\"Clean Cache\"})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:[\"Cache Size: \",formatBytes(systemStatus.cache.size)]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:[\"Cached Files: \",systemStatus.cache.files]}),systemStatus.cache.lastCleanup&&/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",children:[\"Last Cleanup: \",new Date(systemStatus.cache.lastCleanup).toLocaleString()]})]})})})]}),/*#__PURE__*/_jsxs(Dialog,{open:configDialogOpen,onClose:()=>setConfigDialogOpen(false),maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Model Configuration\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:modelConfig.lowCpuMemUsage,onChange:()=>handleConfigChange('lowCpuMemUsage'),disabled:loading}),label:\"Low CPU Memory Usage\"}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",display:\"block\",children:\"Optimize memory usage during model loading\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:modelConfig.useSafetensors,onChange:()=>handleConfigChange('useSafetensors'),disabled:loading}),label:\"Use Safetensors\"}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",display:\"block\",children:\"Use optimized tensor storage format\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(FormControlLabel,{control:/*#__PURE__*/_jsx(Switch,{checked:modelConfig.offloadEnabled,onChange:()=>handleConfigChange('offloadEnabled'),disabled:loading}),label:\"Enable Weight Offloading\"}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",display:\"block\",children:\"Offload model weights to disk when memory is constrained\"})]}),modelConfig.offloadEnabled&&/*#__PURE__*/_jsx(Box,{sx:{mt:2},children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Offload Folder\",value:modelConfig.offloadFolder,onChange:e=>handleOffloadFolderChange(e.target.value),disabled:loading,helperText:\"Directory for storing offloaded model weights\"})})]}),/*#__PURE__*/_jsx(DialogActions,{children:/*#__PURE__*/_jsx(Button,{onClick:()=>setConfigDialogOpen(false),children:\"Close\"})})]})]});}export default SystemStatus;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}