{"ast":null,"code":"import React from'react';import{Box,Paper,Typography,TextField,Button,Grid,CircularProgress,Stepper,Step,StepLabel,List,ListItem,ListItemText,ListItemIcon,IconButton,Alert,FormControl,InputLabel,Select,MenuItem,LinearProgress,Tooltip,Card,CardContent}from'@mui/material';import{Upload as UploadIcon,Description as DescriptionIcon,Delete as DeleteIcon,Settings as SettingsIcon,Error as ErrorIcon,CheckCircle as CheckCircleIcon,Storage as StorageIcon,Memory as MemoryIcon}from'@mui/icons-material';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const SUPPORTED_TYPES=['.pdf','.txt','.doc','.docx'];const FILE_SIZE_LIMIT=10*1024*1024;// 10MB\nconst MIN_DISK_SPACE=1*1024*1024*1024;// 1GB\nconst MIN_MEMORY=512*1024*1024;// 512MB\nconst steps=['Upload Documents','Configure Pipeline','Process Documents','Test Query'];const pipelineConfigs={chunkSize:[500,1000,2000],overlap:[100,200,300],model:['all-MiniLM-L6-v2','all-mpnet-base-v2'],maxTokens:[256,512,1024,2048],temperature:[0.1,0.3,0.5,0.7,0.9]};function RAGPipeline(){const[activeStep,setActiveStep]=React.useState(0);const[files,setFiles]=React.useState([]);const[loading,setLoading]=React.useState(false);const[query,setQuery]=React.useState('');const[response,setResponse]=React.useState('');const[error,setError]=React.useState('');const[config,setConfig]=React.useState({chunkSize:1000,overlap:200,model:'all-MiniLM-L6-v2',maxTokens:512,temperature:0.7});const[results,setResults]=React.useState([]);const[uploadProgress,setUploadProgress]=React.useState({});const[processingStatus,setProcessingStatus]=React.useState({});const[systemStatus,setSystemStatus]=React.useState({diskSpace:{available:0,total:0},memory:{available:0,total:0}});React.useEffect(()=>{// Fetch system status periodically\nconst fetchSystemStatus=async()=>{try{const response=await axios.get('/api/system/status');setSystemStatus(response.data);}catch(error){console.error('Error fetching system status:',error);}};fetchSystemStatus();const interval=setInterval(fetchSystemStatus,5000);return()=>clearInterval(interval);},[]);const validateFile=file=>{const errors=[];const ext='.'+file.name.split('.').pop().toLowerCase();if(!SUPPORTED_TYPES.includes(ext)){errors.push(`File type ${ext} not supported. Supported types: ${SUPPORTED_TYPES.join(', ')}`);}if(file.size>FILE_SIZE_LIMIT){errors.push(`File size exceeds limit of ${FILE_SIZE_LIMIT/1024/1024}MB`);}// Check if we have enough disk space\nif(systemStatus.diskSpace.available<MIN_DISK_SPACE){errors.push(`Insufficient disk space. At least ${MIN_DISK_SPACE/1024/1024/1024}GB required.`);}// Check if we have enough memory\nif(systemStatus.memory.available<MIN_MEMORY){errors.push(`Insufficient memory. At least ${MIN_MEMORY/1024/1024}MB required.`);}return errors;};const handleFileUpload=event=>{const newFiles=Array.from(event.target.files);const errors=[];newFiles.forEach(file=>{const fileErrors=validateFile(file);if(fileErrors.length>0){errors.push(`${file.name}: ${fileErrors.join(', ')}`);}});if(errors.length>0){setError(errors.join('\\n'));return;}setFiles(newFiles);setError('');setUploadProgress({});};const handleDeleteFile=index=>{setFiles(files.filter((_,i)=>i!==index));setUploadProgress(prev=>{const newProgress={...prev};delete newProgress[index];return newProgress;});};const handleConfigChange=field=>event=>{setConfig({...config,[field]:event.target.value});};const formatBytes=bytes=>{if(bytes===0)return'0 B';const k=1024;const sizes=['B','KB','MB','GB','TB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return`${parseFloat((bytes/Math.pow(k,i)).toFixed(2))} ${sizes[i]}`;};const getStatusColor=(value,threshold)=>{if(value>=threshold.high)return'error';if(value>=threshold.medium)return'warning';return'success';};const handleProcessDocuments=async()=>{setLoading(true);setError('');setProcessingStatus({});try{for(const[index,file]of files.entries()){const formData=new FormData();formData.append('file',file);formData.append('config',JSON.stringify(config));setProcessingStatus(prev=>({...prev,[index]:'uploading'}));await axios.post('/api/rag/upload',formData,{headers:{'Content-Type':'multipart/form-data'},onUploadProgress:progressEvent=>{setUploadProgress(prev=>({...prev,[index]:progressEvent.loaded/progressEvent.total*100}));}});setProcessingStatus(prev=>({...prev,[index]:'processing'}));// Poll for processing status\nlet processed=false;while(!processed){const statusResponse=await axios.get(`/api/rag/status/${file.name}`);if(statusResponse.data.status==='completed'){processed=true;setProcessingStatus(prev=>({...prev,[index]:'completed'}));}else if(statusResponse.data.status==='error'){throw new Error(statusResponse.data.error);}await new Promise(resolve=>setTimeout(resolve,1000));}}setActiveStep(prevStep=>prevStep+1);}catch(error){var _error$response,_error$response$data;setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Error processing documents');setProcessingStatus(prev=>Object.keys(prev).reduce((acc,key)=>({...acc,[key]:prev[key]==='processing'?'error':prev[key]}),{}));}finally{setLoading(false);}};const handleQuery=async()=>{setLoading(true);setError('');try{const response=await axios.post('/api/rag/query',{query,config});setResults(response.data.results);const llmResponse=await axios.post('/api/prompt/generate',{prompt:query,config:{temperature:config.temperature,maxTokens:config.maxTokens},context:{documents:response.data.results.map(r=>r.text).join('\\n\\n')}});setResponse(llmResponse.data.response);}catch(error){var _error$response2,_error$response2$data;setError(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Error processing query');}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(Box,{sx:{maxWidth:1200,mx:'auto',mt:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:\"RAG Pipeline\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,sx:{mb:3},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(StorageIcon,{sx:{mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Disk Space\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:[\"Available: \",formatBytes(systemStatus.diskSpace.available)]}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:systemStatus.diskSpace.used/systemStatus.diskSpace.total*100,color:getStatusColor(systemStatus.diskSpace.used/systemStatus.diskSpace.total*100,{medium:70,high:90})})]})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:6,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(MemoryIcon,{sx:{mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Memory Usage\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",gutterBottom:true,children:[\"Available: \",formatBytes(systemStatus.memory.available)]}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:systemStatus.memory.used/systemStatus.memory.total*100,color:getStatusColor(systemStatus.memory.used/systemStatus.memory.total*100,{medium:80,high:90})})]})]})})})]}),/*#__PURE__*/_jsx(Stepper,{activeStep:activeStep,sx:{mb:4},children:steps.map(label=>/*#__PURE__*/_jsx(Step,{children:/*#__PURE__*/_jsx(StepLabel,{children:label})},label))}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mb:2},children:/*#__PURE__*/_jsx(\"pre\",{style:{margin:0,whiteSpace:'pre-wrap'},children:error})}),/*#__PURE__*/_jsxs(Paper,{sx:{p:3},children:[activeStep===0&&/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Upload Documents\"}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",paragraph:true,children:[\"Supported file types: \",SUPPORTED_TYPES.join(', '),/*#__PURE__*/_jsx(\"br\",{}),\"Maximum file size: \",FILE_SIZE_LIMIT/1024/1024,\"MB\"]}),/*#__PURE__*/_jsx(\"input\",{accept:SUPPORTED_TYPES.join(','),style:{display:'none'},id:\"raised-button-file\",multiple:true,type:\"file\",onChange:handleFileUpload}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"raised-button-file\",children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",component:\"span\",startIcon:/*#__PURE__*/_jsx(UploadIcon,{}),children:\"Select Files\"})}),files.length>0&&/*#__PURE__*/_jsx(List,{sx:{mt:2},children:files.map((file,index)=>/*#__PURE__*/_jsxs(ListItem,{secondaryAction:/*#__PURE__*/_jsx(IconButton,{edge:\"end\",onClick:()=>handleDeleteFile(index),disabled:loading,children:/*#__PURE__*/_jsx(DeleteIcon,{})}),children:[/*#__PURE__*/_jsx(ListItemIcon,{children:processingStatus[index]==='completed'?/*#__PURE__*/_jsx(CheckCircleIcon,{color:\"success\"}):processingStatus[index]==='error'?/*#__PURE__*/_jsx(ErrorIcon,{color:\"error\"}):/*#__PURE__*/_jsx(DescriptionIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:file.name,secondary:/*#__PURE__*/_jsxs(_Fragment,{children:[`${(file.size/1024).toFixed(2)} KB`,uploadProgress[index]!==undefined&&/*#__PURE__*/_jsx(Box,{sx:{width:'100%',mt:1},children:/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:uploadProgress[index]})})]})})]},index))}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:()=>setActiveStep(1),disabled:files.length===0,sx:{mt:2},children:\"Next\"})]}),activeStep===1&&/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Configure Pipeline\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Chunk Size\"}),/*#__PURE__*/_jsx(Select,{value:config.chunkSize,label:\"Chunk Size\",onChange:handleConfigChange('chunkSize'),children:pipelineConfigs.chunkSize.map(size=>/*#__PURE__*/_jsxs(MenuItem,{value:size,children:[size,\" characters\"]},size))})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Overlap\"}),/*#__PURE__*/_jsx(Select,{value:config.overlap,label:\"Overlap\",onChange:handleConfigChange('overlap'),children:pipelineConfigs.overlap.map(size=>/*#__PURE__*/_jsxs(MenuItem,{value:size,children:[size,\" characters\"]},size))})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Embedding Model\"}),/*#__PURE__*/_jsx(Select,{value:config.model,label:\"Embedding Model\",onChange:handleConfigChange('model'),children:pipelineConfigs.model.map(model=>/*#__PURE__*/_jsx(MenuItem,{value:model,children:model},model))})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Max Tokens\"}),/*#__PURE__*/_jsx(Select,{value:config.maxTokens,label:\"Max Tokens\",onChange:handleConfigChange('maxTokens'),children:pipelineConfigs.maxTokens.map(tokens=>/*#__PURE__*/_jsxs(MenuItem,{value:tokens,children:[tokens,\" tokens\"]},tokens))})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Temperature\"}),/*#__PURE__*/_jsx(Select,{value:config.temperature,label:\"Temperature\",onChange:handleConfigChange('temperature'),children:pipelineConfigs.temperature.map(temp=>/*#__PURE__*/_jsxs(MenuItem,{value:temp,children:[temp,\" (\",temp<=0.3?'More focused':temp<=0.7?'Balanced':'More creative',\")\"]},temp))})]})})]}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2,display:'flex',gap:1},children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:()=>setActiveStep(0),children:\"Back\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:()=>setActiveStep(2),children:\"Next\"})]})]}),activeStep===2&&/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Process Documents\"}),/*#__PURE__*/_jsxs(Typography,{color:\"textSecondary\",paragraph:true,children:[\"Ready to process \",files.length,\" document(s) with the following configuration:\"]}),/*#__PURE__*/_jsxs(List,{children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(SettingsIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Chunk Size\",secondary:`${config.chunkSize} characters`})]}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(SettingsIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Overlap\",secondary:`${config.overlap} characters`})]}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(SettingsIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Embedding Model\",secondary:config.model})]}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(SettingsIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Max Tokens\",secondary:`${config.maxTokens} tokens`})]}),/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(SettingsIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:\"Temperature\",secondary:`${config.temperature} (${config.temperature<=0.3?'More focused':config.temperature<=0.7?'Balanced':'More creative'})`})]})]}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2,display:'flex',gap:1},children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:()=>setActiveStep(1),disabled:loading,children:\"Back\"}),/*#__PURE__*/_jsxs(Button,{variant:\"contained\",onClick:handleProcessDocuments,disabled:loading,children:[\"Process\",loading&&/*#__PURE__*/_jsx(CircularProgress,{size:24,sx:{ml:1}})]})]})]}),activeStep===3&&/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Test Your RAG Pipeline\"}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Enter your query\",value:query,onChange:e=>setQuery(e.target.value),sx:{mb:2}}),/*#__PURE__*/_jsxs(Button,{variant:\"contained\",onClick:handleQuery,disabled:!query||loading,children:[\"Submit Query\",loading&&/*#__PURE__*/_jsx(CircularProgress,{size:24,sx:{ml:1}})]})]}),results.length>0&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2,mt:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Retrieved Documents\"}),/*#__PURE__*/_jsx(List,{children:results.map((result,index)=>/*#__PURE__*/_jsx(ListItem,{children:/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:1},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle1\",children:[\"Document \",index+1]}),/*#__PURE__*/_jsx(Tooltip,{title:`Similarity Score: ${result.score.toFixed(3)}`,children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{color:result.score>0.8?'success.main':result.score>0.5?'warning.main':'error.main'},children:[\"(\",(result.score*100).toFixed(1),\"% match)\"]})})]}),secondary:result.text})},index))})]})}),response&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Generated Response\"}),/*#__PURE__*/_jsx(Typography,{component:\"pre\",sx:{whiteSpace:'pre-wrap',fontFamily:'monospace',backgroundColor:'grey.100',p:2,borderRadius:1},children:response})]})})]})]})]});}export default RAGPipeline;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}