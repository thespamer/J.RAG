{"ast":null,"code":"import React from'react';import{Box,Paper,Typography,Button,Grid,CircularProgress,Alert,List,ListItem,ListItemText,ListItemIcon,IconButton,Dialog,DialogTitle,DialogContent,DialogActions,TextField,Stepper,Step,StepLabel,Card,CardContent,CardActions,Tooltip,LinearProgress,Chip,FormControlLabel,Switch}from'@mui/material';import{Add as AddIcon,Delete as DeleteIcon,Edit as EditIcon,PlayArrow as PlayIcon,Stop as StopIcon,Save as SaveIcon,Description as DescriptionIcon,Settings as SettingsIcon,Error as ErrorIcon,CheckCircle as CheckCircleIcon,Refresh as RefreshIcon,Storage as StorageIcon,Memory as MemoryIcon}from'@mui/icons-material';import{DragDropContext,Droppable,Draggable}from'react-beautiful-dnd';import axios from'../../services/axios';import{MODEL_CONFIG}from'../../config';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const workflowTemplates=[{name:'Document Processing',description:'Process and analyze documents using RAG',steps:[{name:'Upload Documents',type:'upload',config:{allowedTypes:['.pdf','.txt','.doc','.docx'],maxSize:10*1024*1024// 10MB\n}},{name:'Process Documents',type:'process',config:{chunkSize:1000,overlap:200,model:'all-MiniLM-L6-v2'}},{name:'Generate Summary',type:'generate',config:{model:'deepseek-7b',maxTokens:1024,temperature:0.7,lowCpuMemUsage:true,useSafetensors:true,offloadEnabled:false}}]},{name:'Code Analysis',description:'Analyze code repositories and generate documentation',steps:[{name:'Clone Repository',type:'git',config:{depth:1}},{name:'Analyze Code',type:'analyze',config:{languages:['python','javascript','java'],excludeDirs:['node_modules','venv','.git']}},{name:'Generate Documentation',type:'generate',config:{model:'deepseek-7b',maxTokens:2048,temperature:0.5,lowCpuMemUsage:true,useSafetensors:true,offloadEnabled:false}}]}];const MIN_DISK_SPACE=10*1024*1024*1024;// 10GB\nconst MIN_MEMORY=2*1024*1024*1024;// 2GB\nfunction Workflows(){const[workflows,setWorkflows]=React.useState([]);const[selectedWorkflow,setSelectedWorkflow]=React.useState(null);const[loading,setLoading]=React.useState(false);const[error,setError]=React.useState('');const[createDialogOpen,setCreateDialogOpen]=React.useState(false);const[editDialogOpen,setEditDialogOpen]=React.useState(false);const[workflowName,setWorkflowName]=React.useState('');const[workflowDescription,setWorkflowDescription]=React.useState('');const[workflowSteps,setWorkflowSteps]=React.useState([]);const[executionStatus,setExecutionStatus]=React.useState({});const[executionResults,setExecutionResults]=React.useState({});const[activeStep,setActiveStep]=React.useState(0);const[systemStatus,setSystemStatus]=React.useState({diskSpace:{available:0,total:0},memory:{available:0,total:0},model:{status:'unknown',downloadProgress:0,loadProgress:0,error:null}});React.useEffect(()=>{loadWorkflows();// Fetch system status periodically\nconst fetchSystemStatus=async()=>{try{const[systemRes,modelRes]=await Promise.all([axios.get('/system/status'),axios.get('/models/status')]);setSystemStatus({...systemRes.data,model:modelRes.data});}catch(error){console.error('Error fetching system status:',error);setError('Error fetching system status. Please check the console for details.');}};fetchSystemStatus();const interval=setInterval(fetchSystemStatus,5000);return()=>clearInterval(interval);},[]);const loadWorkflows=async()=>{setLoading(true);try{const response=await axios.get('/workflows');setWorkflows(response.data);setError('');}catch(error){console.error('Error loading workflows:',error);setError('Error loading workflows. Please check the console for details.');}finally{setLoading(false);}};const validateResources=()=>{const errors=[];if(systemStatus.diskSpace.available<MIN_DISK_SPACE){errors.push(`Insufficient disk space. At least ${MIN_DISK_SPACE/1024/1024/1024}GB required.`);}if(systemStatus.memory.available<MIN_MEMORY){errors.push(`Insufficient memory. At least ${MIN_MEMORY/1024/1024/1024}GB required.`);}if(systemStatus.model.status!=='ready'){errors.push('Model is not ready. Please wait for it to finish loading.');}return errors;};const handleCreateWorkflow=()=>{setWorkflowName('');setWorkflowDescription('');setWorkflowSteps([]);setCreateDialogOpen(true);};const handleEditWorkflow=workflow=>{setSelectedWorkflow(workflow);setWorkflowName(workflow.name);setWorkflowDescription(workflow.description);setWorkflowSteps(workflow.steps);setEditDialogOpen(true);};const handleDeleteWorkflow=async workflowId=>{try{await axios.delete(`/workflows/${workflowId}`);loadWorkflows();}catch(error){var _error$response,_error$response$data;setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'Error deleting workflow');}};const handleSaveWorkflow=async()=>{try{if(selectedWorkflow){await axios.put(`/workflows/${selectedWorkflow.id}`,{name:workflowName,description:workflowDescription,steps:workflowSteps});}else{await axios.post('/workflows',{name:workflowName,description:workflowDescription,steps:workflowSteps});}setCreateDialogOpen(false);setEditDialogOpen(false);loadWorkflows();}catch(error){var _error$response2,_error$response2$data;setError(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||'Error saving workflow');}};const handleExecuteWorkflow=async workflow=>{const resourceErrors=validateResources();if(resourceErrors.length>0){setError(resourceErrors.join('\\n'));return;}setLoading(true);setError('');setActiveStep(0);setExecutionStatus({});setExecutionResults({});try{for(const[index,step]of workflow.steps.entries()){setActiveStep(index);setExecutionStatus(prev=>({...prev,[index]:'running'}));const response=await axios.post(`/workflows/${workflow.id}/execute`,{step:index,config:{...step.config,systemStatus:{memory:systemStatus.memory,model:systemStatus.model}}});setExecutionResults(prev=>({...prev,[index]:response.data}));setExecutionStatus(prev=>({...prev,[index]:'completed'}));}setActiveStep(workflow.steps.length);}catch(error){var _error$response3,_error$response3$data;setError(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.error)||'Error executing workflow');setExecutionStatus(prev=>({...prev,[activeStep]:'error'}));}finally{setLoading(false);}};const formatBytes=bytes=>{if(bytes===0)return'0 B';const k=1024;const sizes=['B','KB','MB','GB','TB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return`${parseFloat((bytes/Math.pow(k,i)).toFixed(2))} ${sizes[i]}`;};return/*#__PURE__*/_jsxs(Box,{sx:{maxWidth:1200,mx:'auto',mt:4},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'center',mb:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:\"Workflows\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(AddIcon,{}),onClick:handleCreateWorkflow,children:\"Create Workflow\"})]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,sx:{mb:3},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(StorageIcon,{sx:{mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Disk Space\"})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",children:[\"Available: \",formatBytes(systemStatus.diskSpace.available)]}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:systemStatus.diskSpace.used/systemStatus.diskSpace.total*100,sx:{mt:1}})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(MemoryIcon,{sx:{mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Memory\"})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",children:[\"Available: \",formatBytes(systemStatus.memory.available)]}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:systemStatus.memory.used/systemStatus.memory.total*100,sx:{mt:1}})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(SettingsIcon,{sx:{mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:\"Model Status\"})]}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"textSecondary\",sx:{flexGrow:1},children:[\"DeepSeek LLM 7B: \",systemStatus.model.status]}),systemStatus.model.status==='ready'&&/*#__PURE__*/_jsx(CheckCircleIcon,{color:\"success\"}),systemStatus.model.status==='error'&&/*#__PURE__*/_jsx(ErrorIcon,{color:\"error\"})]}),(systemStatus.model.status==='downloading'||systemStatus.model.status==='loading')&&/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:systemStatus.model.status==='downloading'?systemStatus.model.downloadProgress:systemStatus.model.loadProgress,sx:{mt:1}})]})})})]}),error&&/*#__PURE__*/_jsx(Alert,{severity:\"error\",sx:{mb:2},children:error}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:8,children:workflows.map(workflow=>/*#__PURE__*/_jsxs(Paper,{sx:{p:3,mb:2},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',justifyContent:'space-between',alignItems:'flex-start'},children:[/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",children:workflow.name}),/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",sx:{mb:2},children:workflow.description})]}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleEditWorkflow(workflow),disabled:loading,children:/*#__PURE__*/_jsx(EditIcon,{})}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleDeleteWorkflow(workflow.id),disabled:loading,children:/*#__PURE__*/_jsx(DeleteIcon,{})}),/*#__PURE__*/_jsx(IconButton,{onClick:()=>handleExecuteWorkflow(workflow),disabled:loading,color:\"primary\",children:loading?/*#__PURE__*/_jsx(CircularProgress,{size:24}):/*#__PURE__*/_jsx(PlayIcon,{})})]})]}),/*#__PURE__*/_jsx(Stepper,{activeStep:activeStep,sx:{mb:2},children:workflow.steps.map((step,index)=>/*#__PURE__*/_jsx(Step,{children:/*#__PURE__*/_jsx(StepLabel,{error:executionStatus[index]==='error',icon:executionStatus[index]==='completed'?/*#__PURE__*/_jsx(CheckCircleIcon,{color:\"success\"}):executionStatus[index]==='error'?/*#__PURE__*/_jsx(ErrorIcon,{color:\"error\"}):executionStatus[index]==='running'?/*#__PURE__*/_jsx(CircularProgress,{size:24}):null,children:step.name})},index))}),Object.keys(executionResults).map(stepIndex=>/*#__PURE__*/_jsxs(Paper,{sx:{p:2,mb:1,bgcolor:'grey.100'},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle2\",gutterBottom:true,children:[\"Step \",parseInt(stepIndex)+1,\": \",workflow.steps[stepIndex].name]}),/*#__PURE__*/_jsx(Typography,{component:\"pre\",sx:{whiteSpace:'pre-wrap',fontFamily:'monospace',fontSize:12},children:typeof executionResults[stepIndex]==='object'?JSON.stringify(executionResults[stepIndex],null,2):executionResults[stepIndex]})]},stepIndex))]},workflow.id))}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(Paper,{sx:{p:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Templates\"}),/*#__PURE__*/_jsx(Grid,{container:true,spacing:2,children:workflowTemplates.map(template=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(Card,{sx:{cursor:'pointer','&:hover':{bgcolor:'action.hover'}},onClick:()=>handleTemplateSelect(template),children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",children:template.name}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:template.description}),/*#__PURE__*/_jsx(Box,{sx:{mt:1},children:template.steps.map((step,index)=>/*#__PURE__*/_jsx(Chip,{label:step.name,size:\"small\",sx:{mr:0.5,mb:0.5}},index))})]})})},template.name))})]})})]}),/*#__PURE__*/_jsxs(Dialog,{open:createDialogOpen||editDialogOpen,onClose:()=>{setCreateDialogOpen(false);setEditDialogOpen(false);},maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:editDialogOpen?'Edit Workflow':'Create Workflow'}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(TextField,{autoFocus:true,margin:\"dense\",label:\"Workflow Name\",fullWidth:true,value:workflowName,onChange:e=>setWorkflowName(e.target.value),sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{margin:\"dense\",label:\"Description\",fullWidth:true,multiline:true,rows:2,value:workflowDescription,onChange:e=>setWorkflowDescription(e.target.value),sx:{mb:2}}),/*#__PURE__*/_jsx(Typography,{variant:\"subtitle1\",gutterBottom:true,children:\"Steps\"}),/*#__PURE__*/_jsx(DragDropContext,{onDragEnd:handleDragEnd,children:/*#__PURE__*/_jsx(Droppable,{droppableId:\"steps\",children:provided=>/*#__PURE__*/_jsxs(List,{...provided.droppableProps,ref:provided.innerRef,children:[workflowSteps.map((step,index)=>/*#__PURE__*/_jsx(Draggable,{draggableId:`step-${index}`,index:index,children:provided=>/*#__PURE__*/_jsxs(ListItem,{ref:provided.innerRef,...provided.draggableProps,...provided.dragHandleProps,sx:{bgcolor:'background.paper',mb:1},children:[/*#__PURE__*/_jsx(ListItemIcon,{children:/*#__PURE__*/_jsx(DescriptionIcon,{})}),/*#__PURE__*/_jsx(ListItemText,{primary:step.name,secondary:`Type: ${step.type}`}),/*#__PURE__*/_jsx(IconButton,{edge:\"end\",onClick:()=>{const newSteps=[...workflowSteps];newSteps.splice(index,1);setWorkflowSteps(newSteps);},children:/*#__PURE__*/_jsx(DeleteIcon,{})})]})},index)),provided.placeholder]})})})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>{setCreateDialogOpen(false);setEditDialogOpen(false);},children:\"Cancel\"}),/*#__PURE__*/_jsx(Button,{onClick:handleSaveWorkflow,variant:\"contained\",disabled:!workflowName||workflowSteps.length===0,children:\"Save\"})]})]})]});}export default Workflows;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}